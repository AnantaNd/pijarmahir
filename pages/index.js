import { useSession } from "next-auth/react";
import Head from "next/head";
import Category from "../components/Category/Category";
import CourseCountainer from '../components/CourseContainer/CourseContainer';
import FlashSale from "../components/FlashSale/FlashSale";
import KartuPrakerja from "../components/KartuPrakerja/KartuPrakerja";
import Layouts from "../components/Layouts/Layouts";
import Section from "../components/Section/Section";
import SwiperSlide from "../components/SwiperSlides/SwiperSlides";
import Testimoni from "../components/Testimoni/Testimoni";
import { dataSets } from '../data';
import styles from '../styles/Home.module.css';


export default function Home({kartu_prakerja, flash_sale, mahir_prakerja, best_seller, talent_digital, pilihan_terbaik, testimoni}) {
  const { data: session } = useSession();

  console.log(testimoni.data)
  // console.log('flashSale',flash_sale)
  // console.log('mahirPrakerja',mahir_prakerja)
  return (
    <>
      <Head>
        <title>Pijar Mahir</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/pijar_logo.svg" />
      </Head>

      <Layouts>
        {session?
          <div className={styles.container_session}>
            <h2 className={styles.greeting}>Selamat datang {session.user.name}</h2>
            <p className={styles.sub_greeting}>Ayo bangun karir mu bersama pijar mahir dan dapatkan manfaatnya</p>
          </div>
          :''
        }
        {/* Banner */}
        <Section>
          <SwiperSlide />
        </Section>
        {/* End Banner */}

        {/* Category */}
        <Section>
          <Category data={dataSets.category_course} />
          <div className={styles.hl}></div>
        </Section>
        {/* End Category */}

        {/* Kartu Prakerja */}
        <Section>
          <KartuPrakerja dataCard={kartu_prakerja.data} />
        </Section>
        {/* End Kartu Prakerja */}

        {/* flashsahle */}
        <Section>
          <FlashSale dataCard={flash_sale.data}/>
        </Section>

        {/* Mahir prakerja 2022 */}
        <Section>
          <CourseCountainer title={"Mahir Prakerja 2022"} dataCard={mahir_prakerja.data}/>
        </Section>
        {/* Mahir prakerja 2022 */}

        {/* best seller */}
        <Section>
          <CourseCountainer title={"Best Seller"} dataCard={best_seller.data}/>
        </Section>
        {/* best seller */}

        {/* talenta digital */}
        <Section>
          <CourseCountainer title={"Siap Jadi Talenta Digital Terbaik"} dataCard={talent_digital.data}/>
        </Section>
        {/* talenta digital */}

        {/* pilihan terbaik */}
        <Section>
          <CourseCountainer title={"Pilihan terbaik untuk kamu"} dataCard={pilihan_terbaik.data}/>
        </Section>
        {/* best seller */}

        {/* Mitra */}
        <Section>
          <Category data={dataSets.mitra} title="Mitra Pelatihan" />
        </Section>
        {/* End Mitra */}

        {/* Testimoni */}
        <Section>
          <Testimoni dataCard={testimoni.data}/>
        </Section>
        {/* End Testimoni */}

      </Layouts>

      <footer></footer>
    </>
  );
}

export async function getStaticProps(){
  try{
    const res1 = await fetch('http://localhost:9000/api/v1/collection/kartu_prakerja/')
    const res2 = await fetch('http://localhost:9000/api/v1/collection/flash_sale/')
    const res3 = await fetch('http://localhost:9000/api/v1/collection/mahir_prakerja/')
    const res4 = await fetch('http://localhost:9000/api/v1/collection/best_seller/')
    const res5 = await fetch('http://localhost:9000/api/v1/collection/talenta_digital/')
    const res6 = await fetch('http://localhost:9000/api/v1/collection/pilihan_terbaik/')
    const res7 = await fetch('http://localhost:9000/api/v1/course/rating/')
    const res8 = await fetch('http://localhost:9000/api/v1/category/')

    // response
    const kartu_prakerja = await res1.json()
    const flash_sale = await res2.json()
    const mahir_prakerja = await res3.json()
    const best_seller = await res4.json()
    const talent_digital = await res5.json()
    const pilihan_terbaik = await res6.json()
    const testimoni = await res7.json()
    const kategori = await res8.json()
    return {
      props:{
        kartu_prakerja,
        flash_sale, 
        mahir_prakerja,
        best_seller,
        talent_digital,
        pilihan_terbaik,
        testimoni,
        kategori
      }
    }
  }catch(err){
    console.error(err)
  }
  return{
    props: {
      kartu_prakerja,
      flash_sale,
      mahir_prakerja,
      best_seller,
      talent_digital,
      pilihan_terbaik,
      testimoni,
      kategori

    }
  }
}
